<!DOCTYPE html>    <html>  <head>    <title>nabe.js</title>    <meta http-equiv="content-type" content="text/html; charset=UTF-8">    <link rel="stylesheet" media="all" href="docco.css" />  </head>  <body>    <div id="container">      <div id="background"></div>              <div id="jump_to">          Jump To &hellip;          <div id="jump_wrapper">            <div id="jump_page">                                              <a class="source" href="config.html">                  config.html                </a>                                              <a class="source" href="ext/github.html">                  ext/github.html                </a>                                              <a class="source" href="ext/json.html">                  ext/json.html                </a>                                              <a class="source" href="ext/pages.html">                  ext/pages.html                </a>                                              <a class="source" href="model/posts.html">                  model/posts.html                </a>                                              <a class="source" href="nabe.html">                  nabe.html                </a>                                              <a class="source" href="renderer.html">                  renderer.html                </a>                                              <a class="source" href="routes.html">                  routes.html                </a>                                              <a class="source" href="utils/findgit.html">                  utils/findgit.html                </a>                                              <a class="source" href="utils/git.html">                  utils/git.html                </a>                                              <a class="source" href="utils/util.html">                  utils/util.html                </a>                          </div>          </div>        </div>            <table cellpadding="0" cellspacing="0">        <thead>          <tr>            <th class="docs">              <h1>                nabe.js              </h1>            </th>            <th class="code">            </th>          </tr>        </thead>        <tbody>                                  <tr id="section-1">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-1">&#182;</a>                </div>                <p><strong>nabe</strong> is a git-powered, minimalist blog engine for coders.</p>

<p>A simple (but yet another) blog engine written in node. It basically 
takes the articles/ folder full of markdown post and serves them as a website.</p>

<p>Posts are passed through <a href="http://daringfireball.net/projects/markdown/syntax">Markdown</a>, 
and snippets of code is passed through <a href="http://code.google.com/p/google-code-prettify/">Prettify</a> 
syntax highlighting. This page is the result of running <a href="http://jashkenas.github.com/docco/">Docco</a> 
against its own source files.</p>

<p>The <a href="http://github.com/mklabs/nabe">source for this blog engine</a> is available on GitHub.</p>

<p>This project respectfully uses code from and thanks the authors of:</p>

<ul>
<li><a href="https://github.com/senchalabs/connect">connect</a></li>
<li><a href="https://github.com/creationix/wheat">wheat</a></li>
<li><a href="https://github.com/isaacs/github-flavored-markdown">github-flavored-markdown</a></li>
<li><a href="https://github.com/creationix/node-git">git-fs</a></li>
<li><a href="https://github.com/jquery/jquery-global">jquery-global</a></li>
<li><a href="https://github.com/kof/node-jqtpl">jqtpl</a></li>
<li><a href="https://github.com/visionmedia/js-yaml">yaml</a></li>
<li><a href="https://github.com/paulirish/html5-boilerplate-server-configs/blob/master/node.js">h5b-server-config for node</a></li>
</ul>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-2">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-2">&#182;</a>                </div>                <h2>Connect server</h2>

<p>This file comes with a basic server configuration and is based on 
<a href="https://github.com/paulirish/html5-boilerplate-server-configs/blob/master/node.js">h5b-server-config for node</a></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="kwd">var</span><span class="pln"> mime </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'mime'</span><span class="pun">),</span><span class="pln"><br />connect </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'connect'</span><span class="pun">),</span><span class="pln"><br /></span><span class="typ">Path</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'path'</span><span class="pun">),</span><span class="pln"><br />routes </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./routes'</span><span class="pun">),</span><span class="pln"><br />renderer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./renderer'</span><span class="pun">),</span><span class="pln"><br />util </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./utils/util'</span><span class="pun">),</span><span class="pln"><br />pages </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./ext/pages'</span><span class="pun">),</span><span class="pln"><br />github </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./ext/github'</span><span class="pun">),</span><span class="pln"><br />json </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./ext/json'</span><span class="pun">),</span><span class="pln"><br />admin </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./ext/admin'</span><span class="pun">);</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-3">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-3">&#182;</a>                </div>                <h3>Mimes configuration</h3>

<p>Define early so that connects sees them</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">mime</span><span class="pun">.</span><span class="pln">define</span><span class="pun">({</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="str">'application/x-font-woff'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'woff'</span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="str">'image/vnd.microsoft.icon'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'ico'</span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="str">'image/webp'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'webp'</span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="str">'text/cache-manifest'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'manifest'</span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="str">'text/x-component'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'htc'</span><span class="pun">],</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="str">'application/x-chrome-extension'</span><span class="pun">:</span><span class="pln"> </span><span class="pun">[</span><span class="str">'crx'</span><span class="pun">]</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-4">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-4">&#182;</a>                </div>                <h3>Create and expose the server</h3>              </td>              <td class="code">                <div class="highlight"><pre><span class="kwd">var</span><span class="pln"> nabe </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> connect</span><span class="pun">();</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-5">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-5">&#182;</a>                </div>                <h3>Expose internal tools, helpers and additional layers</h3>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-6">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-6">&#182;</a>                </div>                <ul>
<li><a href="config.html">config</a></li>
<li><a href="util.html">util</a></li>
<li><a href="ext/pages.html">pages</a></li>
<li><a href="ext/github.html">github</a></li>
</ul>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">nabe</span><span class="pun">.</span><span class="pln">config </span><span class="pun">=</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">options</span><span class="pun">;</span><span class="pln"><br />nabe</span><span class="pun">.</span><span class="pln">util </span><span class="pun">=</span><span class="pln"> util</span><span class="pun">;</span><span class="pln"><br />nabe</span><span class="pun">.</span><span class="pln">pages </span><span class="pun">=</span><span class="pln"> pages</span><span class="pun">;</span><span class="pln"><br />nabe</span><span class="pun">.</span><span class="pln">github </span><span class="pun">=</span><span class="pln"> github</span><span class="pun">;</span><span class="pln"><br /><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-7">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-7">&#182;</a>                </div>                <p>good ol'apache like logging
you can customize how the log looks: 
<a href="http://senchalabs.github.com/connect/middleware-logger.html">http://senchalabs.github.com/connect/middleware-logger.html</a></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">nabe<br />&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="pln">connect</span><span class="pun">.</span><span class="pln">logger</span><span class="pun">())</span><span class="pln"><br />&nbsp; <br />&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="pln">connect</span><span class="pun">.</span><span class="pln">bodyParser</span><span class="pun">())</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-8">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-8">&#182;</a>                </div>                <p><strong>router module, more on this <a href="routes.html">here</a></strong></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="pln">connect</span><span class="pun">.</span><span class="pln">router</span><span class="pun">(</span><span class="pln">routes</span><span class="pun">))</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-9">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-9">&#182;</a>                </div>                <p><strong>pages layer, more on this <a href="ext/pages.html">here</a></strong></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="pln">pages</span><span class="pun">())</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-10">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-10">&#182;</a>                </div>                <p><strong>json layer, more on this <a href="ext/json.html">here</a></strong></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="pln">json</span><span class="pun">(</span><span class="pln"> </span><span class="pun">{</span><span class="pln">foo</span><span class="pun">:</span><span class="pln"> </span><span class="str">'bar'</span><span class="pun">}</span><span class="pln"> </span><span class="pun">))</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-11">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-11">&#182;</a>                </div>                <p>admin layer</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="str">'/admin'</span><span class="pun">,</span><span class="pln"> connect</span><span class="pun">.</span><span class="pln">basicAuth</span><span class="pun">(</span><span class="pln">admin</span><span class="pun">.</span><span class="pln">authenticate</span><span class="pun">))</span><span class="pln"><br />&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="str">'/admin'</span><span class="pun">,</span><span class="pln"> admin</span><span class="pun">())</span><span class="pln"><br />&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="pln">connect</span><span class="pun">.</span><span class="kwd">static</span><span class="pun">(</span><span class="typ">Path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">__dirname</span><span class="pun">,</span><span class="pln"> </span><span class="str">'ext'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'admin'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'public'</span><span class="pun">)))</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-12">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-12">&#182;</a>                </div>                <p>set to the <code>public</code> folder in themes.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="pln">connect</span><span class="pun">.</span><span class="kwd">static</span><span class="pun">(</span><span class="typ">Path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">cwd</span><span class="pun">(),</span><span class="pln"> nabe</span><span class="pun">.</span><span class="pln">config</span><span class="pun">.</span><span class="pln">themeDir</span><span class="pun">,</span><span class="pln"> nabe</span><span class="pun">.</span><span class="pln">config</span><span class="pun">.</span><span class="pln">theme</span><span class="pun">,</span><span class="pln"> </span><span class="str">'public'</span><span class="pun">),</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-13">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-13">&#182;</a>                </div>                <p>set your cache maximum age, in milliseconds.
if you don't use cache break use a smaller value</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-14">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-14">&#182;</a>                </div>                <p>maxAge is set to one month</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; maxAge</span><span class="pun">:</span><span class="pln"> </span><span class="lit">1000</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">60</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">60</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">24</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">30</span><span class="pln"><br />&nbsp; </span><span class="pun">}))</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-15">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-15">&#182;</a>                </div>                <p>if no routes matching, returns 404 page</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">req</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">next</span><span class="pun">){</span><span class="pln"><br />&nbsp; &nbsp; renderer</span><span class="pun">.</span><span class="pln">render</span><span class="pun">(</span><span class="str">'page.404.html'</span><span class="pun">,</span><span class="pln"> res</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; error</span><span class="pun">:</span><span class="pln"> </span><span class="str">'404 Not found'</span><span class="pun">,</span><span class="pln"> <br />&nbsp; &nbsp; &nbsp; headers</span><span class="pun">:</span><span class="pln"> req</span><span class="pun">.</span><span class="pln">headers</span><span class="pun">,</span><span class="pln"> content</span><span class="pun">:</span><span class="pln"> util</span><span class="pun">.</span><span class="pln">toHtml</span><span class="pun">(</span><span class="str">'tmpl.page.404.html'</span><span class="pun">,</span><span class="pln"> </span><span class="pun">{</span><span class="pln">config</span><span class="pun">:</span><span class="pln"> renderer</span><span class="pun">.</span><span class="pln">options</span><span class="pun">})</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; </span><span class="pun">})</span><span class="pln"><br />&nbsp; </span><span class="pun">.</span><span class="kwd">use</span><span class="pun">(</span><span class="pln">connect</span><span class="pun">.</span><span class="pln">errorHandler</span><span class="pun">({</span><span class="pln"><br />&nbsp; &nbsp; stack</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; message</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">dump</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pln"><br />&nbsp; </span><span class="pun">}));</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-16">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-16">&#182;</a>                </div>                <h3>Error handling</h3>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-17">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-17">&#182;</a>                </div>                <p>this is a failsafe, it will catch the error silently and logged it the console.
While this works, you should really try to catch the errors with a try/catch block
more on this <a href="http://nodejs.org/docs/v0.4.7/api/process.html#event_uncaughtException_">here</a></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-18">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-18">&#182;</a>                </div>                <p>sync methods in node throw exceptions, and async method pass the error
as the first argument. This is also the pattern used in connect. Try to avoid try/catch block
in your code, especially if it is async code. More 
<a href="https://groups.google.com/d/topic/nodejs/W9UVJCKcJ7Q/discussion">on</a>
<a href="https://groups.google.com/d/msg/nodejs/W9UVJCKcJ7Q/rzseRbourCUJ">this</a>
<a href="https://groups.google.com/d/msg/nodejs/W9UVJCKcJ7Q/oYoCP_3vvpYJ">here</a>.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">process</span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'uncaughtException'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp;console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Caught exception: '</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> err</span><span class="pun">.</span><span class="pln">stack</span><span class="pun">);</span><span class="pln"><br /></span><span class="pun">});</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                  </tbody>      </table>    </div>  </body>  </html>
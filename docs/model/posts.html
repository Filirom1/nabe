<!DOCTYPE html>    <html>  <head>    <title>posts.js</title>    <meta http-equiv="content-type" content="text/html; charset=UTF-8">    <link rel="stylesheet" media="all" href="../docco.css" />  </head>  <body>    <div id="container">      <div id="background"></div>              <div id="jump_to">          Jump To &hellip;          <div id="jump_wrapper">            <div id="jump_page">                                              <a class="source" href="../config.html">                  config.html                </a>                                              <a class="source" href="../ext/github.html">                  ext/github.html                </a>                                              <a class="source" href="../ext/json.html">                  ext/json.html                </a>                                              <a class="source" href="../ext/pages.html">                  ext/pages.html                </a>                                              <a class="source" href="../model/posts.html">                  model/posts.html                </a>                                              <a class="source" href="../nabe.html">                  nabe.html                </a>                                              <a class="source" href="../renderer.html">                  renderer.html                </a>                                              <a class="source" href="../routes.html">                  routes.html                </a>                                              <a class="source" href="../utils/findgit.html">                  utils/findgit.html                </a>                                              <a class="source" href="../utils/git.html">                  utils/git.html                </a>                                              <a class="source" href="../utils/util.html">                  utils/util.html                </a>                          </div>          </div>        </div>            <table cellpadding="0" cellspacing="0">        <thead>          <tr>            <th class="docs">              <h1>                posts.js              </h1>            </th>            <th class="code">            </th>          </tr>        </thead>        <tbody>                                  <tr id="section-1">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-1">&#182;</a>                </div>                <p>Provides needed interface to read blog posts from the git repo</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> fs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">),</span><span class="pln"><br /></span><span class="typ">Path</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'path'</span><span class="pun">),</span><span class="pln"><br />sys </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'sys'</span><span class="pun">),</span><span class="pln"><br /><br />config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'../config'</span><span class="pun">),</span><span class="pln"><br />util </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'../utils/util'</span><span class="pun">),</span><span class="pln"><br />findgit </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'../utils/findgit'</span><span class="pun">),</span><span class="pln"><br />git </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'../utils/git'</span><span class="pun">),</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-2">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-2">&#182;</a>                </div>                <h3>sortArticles(posts)</h3>

<p>Private helper functions that provides sort ability.
It basically sort files objects (must have a date prop) by most recent ones.
It then replaces date property for each post with globalized value thanks to 
jquery.global plugin ported to node</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">sortArticles </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> sortArticles</span><span class="pun">(</span><span class="pln">options</span><span class="pun">,</span><span class="pln"> posts</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; posts </span><span class="pun">=</span><span class="pln"> posts</span><span class="pun">.</span><span class="pln">sort</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> b</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Date</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">b</span><span class="pun">.</span><span class="pln">date</span><span class="pun">))</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="pun">(</span><span class="typ">Date</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">a</span><span class="pun">.</span><span class="pln">date</span><span class="pun">));</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; <br />&nbsp; posts</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">post</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; post</span><span class="pun">.</span><span class="pln">date </span><span class="pun">=</span><span class="pln"> util</span><span class="pun">.</span><span class="pln">parseDate</span><span class="pun">(</span><span class="pln">post</span><span class="pun">.</span><span class="pln">date</span><span class="pun">,</span><span class="pln"> options</span><span class="pun">.</span><span class="pln">format</span><span class="pun">,</span><span class="pln"> options</span><span class="pun">.</span><span class="pln">culture</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; <br />&nbsp; </span><span class="kwd">return</span><span class="pln"> posts</span><span class="pun">;</span><span class="pln"><br /></span><span class="pun">},</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-3">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-3">&#182;</a>                </div>                <h3>processArticles(options, files, tag, callback)</h3>

<p>private helper function that </p>

<ul>
<li>parse out the list of files</li>
<li>extract meta informations</li>
<li>parse markdown</li>
<li>and sort them by date</li>
</ul>

<p>If the second paramters is a string, tag is assumed and only matching articles are returned.
Otherwise, <code>processArticles(options, files, callback)</code></p>

<p>files are returned as an array of objects <code>{name, data, author, categories, markdown}</code></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">processArticles </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> processArticles</span><span class="pun">(</span><span class="pln">options</span><span class="pun">,</span><span class="pln"> files</span><span class="pun">,</span><span class="pln"> tag</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> filecount </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"><br />&nbsp; ln </span><span class="pun">=</span><span class="pln"> files</span><span class="pun">.</span><span class="pln">length </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"><br />&nbsp; abspath </span><span class="pun">=</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">articleDir</span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">/\/$/</span><span class="pun">,</span><span class="pln"> </span><span class="str">''</span><span class="pun">),</span><span class="pln"><br />&nbsp; summary </span><span class="pun">=</span><span class="pln"> options</span><span class="pun">.</span><span class="pln">summary</span><span class="pun">,</span><span class="pln"><br />&nbsp; delim </span><span class="pun">=</span><span class="pln"> summary</span><span class="pun">.</span><span class="pln">delim </span><span class="pun">?</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RegExp</span><span class="pun">(</span><span class="pln">summary</span><span class="pun">.</span><span class="pln">delim</span><span class="pun">)</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">,</span><span class="pln"><br />&nbsp; arts </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln"><br />&nbsp; <br />&nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="kwd">typeof</span><span class="pln"> tag </span><span class="pun">==</span><span class="pln"> </span><span class="str">'function'</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> arguments</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&gt;=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; callback </span><span class="pun">=</span><span class="pln"> tag</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; tag </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; <br />&nbsp; </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">files</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> callback</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Error</span><span class="pun">(</span><span class="str">'no files'</span><span class="pun">));</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; files</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; git</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">,</span><span class="pln"> file</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> body</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> props</span><span class="pun">,</span><span class="pln"> sum</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">next</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-4">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-4">&#182;</a>                </div>                <p>extract meta informations</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; props </span><span class="pun">=</span><span class="pln"> util</span><span class="pun">.</span><span class="pln">parseProps</span><span class="pun">(</span><span class="pln">body</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-5">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-5">&#182;</a>                </div>                <p>set post name, simply the filename minus its absolute path and extension</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> file<br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="pln">abspath </span><span class="pun">+</span><span class="pln"> </span><span class="str">'/'</span><span class="pun">,</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">'.markdown'</span><span class="pun">,</span><span class="pln"> </span><span class="str">''</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-6">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-6">&#182;</a>                </div>                <p>generate markdown property, its html representation. </p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-7">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-7">&#182;</a>                </div>                <p>summary are generated and stop on the very first <code>summary.delim</code> config occurence</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; sum </span><span class="pun">=</span><span class="pln"> delim </span><span class="pun">&amp;&amp;</span><span class="pln"> delim</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">props</span><span class="pun">.</span><span class="pln">markdown</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> props</span><span class="pun">.</span><span class="pln">markdown</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="pln">delim</span><span class="pun">)[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> props</span><span class="pun">.</span><span class="pln">markdown</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-8">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-8">&#182;</a>                </div>                <p>if post content does not have a delimiter within, summary are full article.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">markdown </span><span class="pun">=</span><span class="pln"> util</span><span class="pun">.</span><span class="pln">markdown</span><span class="pun">(</span><span class="pln">sum</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-9">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-9">&#182;</a>                </div>                <p>if we have a tag to filter on, only append files that have categories matching</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">tag</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">props</span><span class="pun">.</span><span class="pln">categories </span><span class="pun">&amp;&amp;</span><span class="pln"> props</span><span class="pun">.</span><span class="pln">categories</span><span class="pun">.</span><span class="pln">indexOf</span><span class="pun">(</span><span class="pln">tag</span><span class="pun">)</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; arts</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">props</span><span class="pun">);</span><span class="pln"> <br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; arts</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">props</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">ln </span><span class="pun">===</span><span class="pln"> filecount</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> callback</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> sortArticles</span><span class="pun">(</span><span class="pln">options</span><span class="pun">,</span><span class="pln"> arts</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; filecount</span><span class="pun">++;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"> &nbsp;<br />&nbsp; </span><span class="pun">});</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br /></span><span class="kwd">var</span><span class="pln"> </span><span class="typ">Posts</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="typ">Posts</span><span class="pun">(</span><span class="pln">o</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">var</span><span class="pln"> refs </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">cwd</span><span class="pun">(),</span><span class="pln"> </span><span class="str">".git"</span><span class="pun">,</span><span class="pln"> </span><span class="str">"packed-refs"</span><span class="pun">);</span><span class="pln"><br />&nbsp; <br />&nbsp; </span><span class="kwd">try</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-10">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-10">&#182;</a>                </div>                <p>Check is this is a working repo</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; fs</span><span class="pun">.</span><span class="pln">statSync</span><span class="pun">(</span><span class="pln">refs</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; git</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">cwd</span><span class="pun">());</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">validRepo</span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">catch</span><span class="pln"> </span><span class="pun">(</span><span class="pln">e</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; console</span><span class="pun">.</span><span class="pln">warn</span><span class="pun">(</span><span class="str">'not a valid repo'</span><span class="pun">,</span><span class="pln"> refs</span><span class="pun">,</span><span class="pln"> </span><span class="str">'. No revisions for you.'</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"> &nbsp;<br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-11">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-11">&#182;</a>                </div>                <p>options here are the merged results of defaults <code>config.js</code> file
and template's <code>config.yml</code></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">options </span><span class="pun">=</span><span class="pln"> o</span><span class="pun">;</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-12">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-12">&#182;</a>                </div>                <h2>Posts</h2>

<p>Our data source</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="typ">Posts</span><span class="pun">.</span><span class="pln">prototype </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-13">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-13">&#182;</a>                </div>                <h3>.all(path, callback)</h3>

<p>Loads all posts files</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; all</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> all</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> files </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln"><br /><br />&nbsp; &nbsp; findgit</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln">path</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'error'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">){</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; callback</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">})</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'file'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> stat</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-14">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-14">&#182;</a>                </div>                <p>Filter out non markdown files and special ones</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!(/\.</span><span class="pln">markdown$</span><span class="pun">/.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">file</span><span class="pun">))</span><span class="pln"> </span><span class="pun">||</span><span class="pln"> </span><span class="str">/_sidebar\.markdown$/</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">file</span><span class="pun">))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; files</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">file</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">})</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'end'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFiles</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> files</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-15">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-15">&#182;</a>                </div>                <h3>.find(path, callback)</h3>

<p>Loads an article complete with log information</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; find</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> find</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">validRepo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; git</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">handleFile</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; git</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> logs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-16">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-16">&#182;</a>                </div>                <p>no error handling here, if err, there was most likely no commit
in any case, still grab file content</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; git</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">handleFile</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> logs</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-17">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-17">&#182;</a>                </div>                <h3>.revision(path, callback)</h3>

<p>alternately, if we have a version (sha), loads in an article
from git history. find and revision are almost identical, thus may 
become a single method.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; revision</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">version</span><span class="pun">,</span><span class="pln"> file</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> path </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="pln">config</span><span class="pun">.</span><span class="pln">articleDir</span><span class="pun">,</span><span class="pln"> file </span><span class="pun">+</span><span class="pln"> </span><span class="str">'.markdown'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(!</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">validRepo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; git</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">handleFile</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; git</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> logs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="kwd">return</span><span class="pln"> callback</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);}</span><span class="pln"> &nbsp;<br />&nbsp; &nbsp; &nbsp; git</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="pln">version</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">handleFile</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> logs</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-18">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-18">&#182;</a>                </div>                <h3>.tags(path, tag, callback)</h3>

<p>Loads the list of posts that match requested tag. posts are sorted by most recent one.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; tags</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> tags</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> tag</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> files </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln"><br /><br />&nbsp; &nbsp; findgit</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln">path</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'file'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> stat</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(!(/\.</span><span class="pln">markdown$</span><span class="pun">/.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)))</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; files</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">file</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">})</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'end'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFiles</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> files</span><span class="pun">,</span><span class="pln"> tag</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-19">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-19">&#182;</a>                </div>                <h3>.categories(path, filter, callback)</h3>

<p>Loads the list of posts that match requested category. takes a path to scan 
and filter(regex) to apply to. posts are then sorted by most recent one.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; categories</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> categories</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> filter</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> files </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; findgit</span><span class="pun">.</span><span class="pln">find</span><span class="pun">(</span><span class="pln">path</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'error'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">){</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; callback</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">})</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'file'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> stat</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> match </span><span class="pun">=</span><span class="pln"> filter</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="str">/\.markdown/</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">file</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(!</span><span class="pln">match</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; files</span><span class="pun">.</span><span class="pln">push</span><span class="pun">(</span><span class="pln">file</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">})</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">on</span><span class="pun">(</span><span class="str">'end'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">handleFiles</span><span class="pun">.</span><span class="pln">bind</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> files</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-20">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-20">&#182;</a>                </div>                <h4>.edit(path, message, content, callback)</h4>

<p>This method allows one to write to the file system, and usually used
to either edit or create a file, if path does not exist.
If successful, and the git repo is correctly set up (<code>.git/packed-refs</code> exists), 
a new commit is done using global configuration (eg. values defined in git config)</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; edit</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> message</span><span class="pun">,</span><span class="pln"> content</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> file </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Path</span><span class="pun">.</span><span class="pln">join</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">options</span><span class="pun">.</span><span class="pln">articleDir</span><span class="pun">,</span><span class="pln"> path </span><span class="pun">+</span><span class="pln"> </span><span class="str">'.markdown'</span><span class="pun">),</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; message </span><span class="pun">=</span><span class="pln"> message </span><span class="pun">||</span><span class="pln"> </span><span class="str">'default message'</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; fs</span><span class="pun">.</span><span class="pln">writeFile</span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> content</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="kwd">return</span><span class="pln"> callback</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(!</span><span class="kwd">self</span><span class="pun">.</span><span class="pln">validRepo</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> callback</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; git</span><span class="pun">.</span><span class="pln">commit</span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> message</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> text</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="kwd">return</span><span class="pln"> callback</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> callback</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> text</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"> <br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br />&nbsp; search</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">term</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">where</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; git</span><span class="pun">.</span><span class="pln">grep</span><span class="pun">(</span><span class="pln">term</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">where</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> files</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">err </span><span class="pun">||</span><span class="pln"> </span><span class="pun">!</span><span class="pln">files</span><span class="pun">.</span><span class="pln">length</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> callback</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> files</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; files </span><span class="pun">=</span><span class="pln"> files</span><span class="pun">.</span><span class="pln">filter</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> &nbsp;</span><span class="pun">(</span><span class="str">/\.markdown/</span><span class="pun">).</span><span class="pln">test</span><span class="pun">(</span><span class="pln">a</span><span class="pun">)</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> </span><span class="pun">!(/</span><span class="pln">_sidebar</span><span class="pun">/.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">a</span><span class="pun">));</span><span class="pln"> </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">self</span><span class="pun">.</span><span class="pln">handleFiles</span><span class="pun">(</span><span class="pln">files</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-21">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-21">&#182;</a>                </div>                <h3>.handleFiles(path, filter, callback)</h3>

<p>expose this helper function</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; handleFiles</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> handleFiles </span><span class="pun">(</span><span class="pln">files</span><span class="pun">,</span><span class="pln"> tag</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; processArticles</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">options</span><span class="pun">,</span><span class="pln"> files</span><span class="pun">,</span><span class="pln"> tag</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-22">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-22">&#182;</a>                </div>                <h3>.handleFile</h3>

<p>convenience method. mimics <code>handleFiles</code> behaviour (meta parse, markdown, ...)
while setting up revisions property from git history.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; handleFile</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">logs</span><span class="pun">,</span><span class="pln"> path</span><span class="pun">,</span><span class="pln"> callback</span><span class="pun">,</span><span class="pln"> err</span><span class="pun">,</span><span class="pln"> body</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> props </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> callback</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);</span><span class="pln"> </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; props </span><span class="pun">=</span><span class="pln"> util</span><span class="pun">.</span><span class="pln">parseProps</span><span class="pun">(</span><span class="pln">body</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">name </span><span class="pun">=</span><span class="pln"> path<br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="pln">process</span><span class="pun">.</span><span class="pln">cwd</span><span class="pun">(),</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">RegExp</span><span class="pun">(</span><span class="str">'/?'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">articleDir </span><span class="pun">+</span><span class="pln"> </span><span class="str">'/?'</span><span class="pun">),</span><span class="pln"> </span><span class="str">''</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">'.markdown'</span><span class="pun">,</span><span class="pln"> </span><span class="str">''</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">markdown </span><span class="pun">=</span><span class="pln"> body</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">body </span><span class="pun">=</span><span class="pln"> util</span><span class="pun">.</span><span class="pln">markdown</span><span class="pun">(</span><span class="pln">util</span><span class="pun">.</span><span class="pln">extractProps</span><span class="pun">(</span><span class="pln">body</span><span class="pun">));</span><span class="pln"><br />&nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">date </span><span class="pun">=</span><span class="pln"> util</span><span class="pun">.</span><span class="pln">parseDate</span><span class="pun">(</span><span class="pln">props</span><span class="pun">.</span><span class="pln">date</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">options</span><span class="pun">.</span><span class="pln">format</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">options</span><span class="pun">.</span><span class="pln">culture</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">revisions </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{};</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-23">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-23">&#182;</a>                </div>                <p>globalize revisions date as well</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> sha </span><span class="kwd">in</span><span class="pln"> logs</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">revisions</span><span class="pun">[</span><span class="pln">sha</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; author</span><span class="pun">:</span><span class="pln"> logs</span><span class="pun">[</span><span class="pln">sha</span><span class="pun">].</span><span class="pln">author</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; message</span><span class="pun">:</span><span class="pln"> logs</span><span class="pun">[</span><span class="pln">sha</span><span class="pun">].</span><span class="pln">message</span><span class="pun">,</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; date</span><span class="pun">:</span><span class="pln"> util</span><span class="pun">.</span><span class="pln">parseDate</span><span class="pun">(</span><span class="pln">logs</span><span class="pun">[</span><span class="pln">sha</span><span class="pun">].</span><span class="pln">date</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">options</span><span class="pun">.</span><span class="pln">format</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">options</span><span class="pun">.</span><span class="pln">culture</span><span class="pun">)</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">};</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; callback</span><span class="pun">(</span><span class="kwd">null</span><span class="pun">,</span><span class="pln"> props</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                  </tbody>      </table>    </div>  </body>  </html>
<!DOCTYPE html>    <html>  <head>    <title>util.js</title>    <meta http-equiv="content-type" content="text/html; charset=UTF-8">    <link rel="stylesheet" media="all" href="docco.css" />  </head>  <body>    <div id="container">      <div id="background"></div>              <div id="jump_to">          Jump To &hellip;          <div id="jump_wrapper">            <div id="jump_page">                                              <a class="source" href="config.html">                  config.html                </a>                                              <a class="source" href="ext/github.html">                  ext/github.html                </a>                                              <a class="source" href="ext/json.html">                  ext/json.html                </a>                                              <a class="source" href="ext/pages.html">                  ext/pages.html                </a>                                              <a class="source" href="model/posts.html">                  model/posts.html                </a>                                              <a class="source" href="nabe.html">                  nabe.html                </a>                                              <a class="source" href="renderer.html">                  renderer.html                </a>                                              <a class="source" href="routes.html">                  routes.html                </a>                                              <a class="source" href="util.html">                  util.html                </a>                          </div>          </div>        </div>            <table cellpadding="0" cellspacing="0">        <thead>          <tr>            <th class="docs">              <h1>                util.js              </h1>            </th>            <th class="code">            </th>          </tr>        </thead>        <tbody>                                  <tr id="section-1">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-1">&#182;</a>                </div>                <p>This files define a basic set of utility methods.
It namely acts as a facade towards several external dependencies
such as</p>

<ul>
<li><a href="https://github.com/kof/node-jqtpl">jqtpl</a></li>
<li><a href="http://code.google.com/p/google-code-prettify/">pretiffy</a></li>
<li><a href="https://github.com/isaacs/github-flavored-markdown">github-flavored-markdown</a></li>
<li><a href="https://github.com/jquery/jquery-global">jquery-global</a></li>
</ul>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln"><br /></span><span class="kwd">var</span><span class="pln"> fs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">),</span><span class="pln"><br />qs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'querystring'</span><span class="pun">),</span><span class="pln"><br />jqtpl </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'jqtpl'</span><span class="pun">),</span><span class="pln"><br />prettify </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'prettify'</span><span class="pun">),</span><span class="pln"><br />ghm </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'github-flavored-markdown'</span><span class="pun">),</span><span class="pln"><br />jqg </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'jquery-global'</span><span class="pun">),</span><span class="pln"><br /><br />path </span><span class="pun">=</span><span class="pln"> process</span><span class="pun">.</span><span class="pln">cwd</span><span class="pun">(),</span><span class="pln"><br />config </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'./config'</span><span class="pun">),</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-2">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-2">&#182;</a>                </div>                <h3>compile(file)</h3>

<p>Private helper which takes care of compiling templates for later use</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">compile </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> compile</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> </span><span class="str">'utf8'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> tmpl</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">throw</span><span class="pln"> err</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-3">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-3">&#182;</a>                </div>                <p>templates are registered as <code>tmpl.filename.ext</code> or <code>tmpl.page.filename.ext</code></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; file </span><span class="pun">=</span><span class="pln"> </span><span class="str">'tmpl.'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="pun">(</span><span class="pln"> </span><span class="str">/\/pages\//</span><span class="pun">.</span><span class="pln">test</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="str">'page.'</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="str">''</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> file</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">).</span><span class="pln">reverse</span><span class="pun">()[</span><span class="lit">0</span><span class="pun">];</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">jqtpl</span><span class="pun">.</span><span class="kwd">template</span><span class="pun">[</span><span class="pln">file</span><span class="pun">])</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">delete</span><span class="pln"> jqtpl</span><span class="pun">.</span><span class="kwd">template</span><span class="pun">[</span><span class="pln">file</span><span class="pun">];</span><span class="pln"> <br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; jqtpl</span><span class="pun">.</span><span class="kwd">template</span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> tmpl</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">});</span><span class="pln"> <br /></span><span class="pun">},</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-4">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-4">&#182;</a>                </div>                <h3>fileChange(file)</h3>

<p>Private helper which compare prev/curr mtime and call compile function
when appropriate</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">fileChange </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"> </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> fileChange</span><span class="pun">(</span><span class="pln">curr</span><span class="pun">,</span><span class="pln"> prev</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; </span><span class="kwd">if</span><span class="pun">(+</span><span class="pln">curr</span><span class="pun">.</span><span class="pln">mtime </span><span class="pun">!==</span><span class="pln"> </span><span class="pun">+</span><span class="pln">prev</span><span class="pun">.</span><span class="pln">mtime</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; compile</span><span class="pun">(</span><span class="pln">file</span><span class="pun">);</span><span class="pln"> <br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">}};</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-5">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-5">&#182;</a>                </div>                <h2>Helpers &amp; Setup</h2>              </td>              <td class="code">                <div class="highlight"><pre><span class="kwd">module</span><span class="pun">.</span><span class="pln">exports </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-6">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-6">&#182;</a>                </div>                <h3>.markdown(markdown)</h3>

<p>markdown helper, delegates to <a href="https://github.com/isaacs/github-flavored-markdown">github-flavored-markdown module</a></p>

<blockquote>
  <p>To get the sha/issue/fork links, pass in a second argument specifying 
  the current project that things should be relative to.</p>
</blockquote>

<p><code>ghm.parse("I **love** GHM.\n\n#2", "isaacs/npm")</code></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; markdown</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> toHtml</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> ghm</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> arguments</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-7">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-7">&#182;</a>                </div>                <h3>.toHtml(template, data)</h3>

<p>template helper, delegates to <a href="https://github.com/kof/node-jqtpl">jqtpl</a></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; toHtml</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> jqtpl</span><span class="pun">.</span><span class="pln">tmpl</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> arguments</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-8">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-8">&#182;</a>                </div>                <h3>.hasTmpl(template)</h3>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; hasTmpl</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="kwd">template</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">!!</span><span class="pln">jqtpl</span><span class="pun">.</span><span class="kwd">template</span><span class="pun">[</span><span class="kwd">template</span><span class="pun">];</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-9">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-9">&#182;</a>                </div>                <h3>.pretiffy(str)</h3>

<p>prettify helper, replace each code snippets with syntax highlighted one. 
delegated to <a href="http://code.google.com/p/google-code-prettify/">pretiffy</a></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; prettify</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">str</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> str</span><span class="pun">.</span><span class="pln">replace</span><span class="pun">(</span><span class="str">/</span><pre><code><span class="str">[^&lt;]+&lt;\/code&gt;&lt;\/pre&gt;/</span><span class="pln">g</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">code</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; code </span><span class="pun">=</span><span class="pln"> code</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="str">/</span><code><span class="str">([\s\S]+)&lt;\/code&gt;/</span><span class="pun">)[</span><span class="lit">1</span><span class="pun">];</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; code </span><span class="pun">=</span><span class="pln"> prettify</span><span class="pun">.</span><span class="pln">prettyPrintOne</span><span class="pun">(</span><span class="pln">code</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="str">"</span><pre><code><span class="str">"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> code </span><span class="pun">+</span><span class="pln"> </span><span class="str">"</span></code></pre><span class="str">"</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-10">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-10">&#182;</a>                </div>                <h3>.parseProps(markdown)</h3>

<p>metadata helper, it returns an object matching properties and values defined
on top of each post file.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; parseProps</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> parseProps</span><span class="pun">(</span><span class="pln">markdown</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> props </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{},</span><span class="pln"><br />&nbsp; &nbsp; match </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="kwd">while</span><span class="pun">(</span><span class="pln"> </span><span class="pun">(</span><span class="pln">match </span><span class="pun">=</span><span class="pln"> markdown</span><span class="pun">.</span><span class="pln">match</span><span class="pun">(</span><span class="str">/^([a-z]+):\s*(.*)\s*\n/</span><span class="pln">i</span><span class="pun">))</span><span class="pln"> </span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> name </span><span class="pun">=</span><span class="pln"> match</span><span class="pun">[</span><span class="lit">1</span><span class="pun">].</span><span class="pln">toLowerCase</span><span class="pun">(),</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; value </span><span class="pun">=</span><span class="pln"> match</span><span class="pun">[</span><span class="lit">2</span><span class="pun">];</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; markdown </span><span class="pun">=</span><span class="pln"> markdown</span><span class="pun">.</span><span class="pln">substr</span><span class="pun">(</span><span class="pln">match</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">length</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; props</span><span class="pun">[</span><span class="pln">name</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> value</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">markdown </span><span class="pun">=</span><span class="pln"> markdown</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">props</span><span class="pun">.</span><span class="pln">categories </span><span class="pun">!==</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; props</span><span class="pun">.</span><span class="pln">categories </span><span class="pun">=</span><span class="pln"> props</span><span class="pun">.</span><span class="pln">categories</span><span class="pun">.</span><span class="pln">split</span><span class="pun">(</span><span class="str">','</span><span class="pun">).</span><span class="pln">map</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">element</span><span class="pun">){</span><span class="pln"> <br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> qs</span><span class="pun">.</span><span class="pln">escape</span><span class="pun">(</span><span class="pln">element</span><span class="pun">.</span><span class="pln">trim</span><span class="pun">());</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> props</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-11">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-11">&#182;</a>                </div>                <h3>.extractProps(markdown)</h3>

<p>a simple helper that removes meta properties and returns post content</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; extractProps</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> extractProps</span><span class="pun">(</span><span class="pln">markdown</span><span class="pun">){</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> markdown</span><span class="pun">.</span><span class="pln">substr</span><span class="pun">(</span><span class="pln">markdown</span><span class="pun">.</span><span class="pln">indexOf</span><span class="pun">(</span><span class="str">'\n\n'</span><span class="pun">));</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-12">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-12">&#182;</a>                </div>                <h3>.parseDate(date, format, culture)</h3>

<p>date format helper, done thanks to <a href="https://github.com/jquery/jquery-global">jquery.global plugin</a>
ported to node.</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; parseDate</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">date</span><span class="pun">,</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> culture</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; format </span><span class="pun">=</span><span class="pln"> format </span><span class="pun">||</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">format</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; culture </span><span class="pun">=</span><span class="pln"> culture </span><span class="pun">||</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">culture</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-13">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-13">&#182;</a>                </div>                <p>require globalization file if needed</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">culture </span><span class="pun">!==</span><span class="pln"> </span><span class="str">'en'</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'jquery-global/globinfo/Globalization.'</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> culture</span><span class="pun">);</span><span class="pln"> <br />&nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br />&nbsp; &nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-14">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-14">&#182;</a>                </div>                <p>returns a localized date, depending on format
and culture provided</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> jqg</span><span class="pun">.</span><span class="kwd">global</span><span class="pun">.</span><span class="pln">format</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Date</span><span class="pun">(</span><span class="pln">date</span><span class="pun">),</span><span class="pln"> format</span><span class="pun">,</span><span class="pln"> culture</span><span class="pun">);</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-15">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-15">&#182;</a>                </div>                <h3>.addTemplate(file)</h3>

<p>compile template file for later use, also register
to file changes to automatically recompile them</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; addTemplate</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> addTemplate</span><span class="pun">(</span><span class="pln">file</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; compile</span><span class="pun">(</span><span class="pln">file</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; fs</span><span class="pun">.</span><span class="pln">watchFile</span><span class="pun">(</span><span class="pln">file</span><span class="pun">,</span><span class="pln"> fileChange</span><span class="pun">(</span><span class="pln">file</span><span class="pun">));</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-16">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-16">&#182;</a>                </div>                <h3>.sidebarize(cb)</h3>

<p>sidebar curry helper, gets a special <code>_sidebar.markdown</code> file if it exists and place it in 
data provided to the callback function. Also set up a simple cache system for this
particular file</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; sidebarize</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> sidebarize</span><span class="pun">(</span><span class="pln">fn</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> cache</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">target</span><span class="pun">,</span><span class="pln"> data</span><span class="pun">,</span><span class="pln"> force</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">var</span><span class="pln"> </span><span class="kwd">self</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> args </span><span class="pun">=</span><span class="pln"> arguments</span><span class="pun">;</span><span class="pln"><br /><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">cache</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; data</span><span class="pun">.</span><span class="pln">sidebar </span><span class="pun">=</span><span class="pln"> cache</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; data</span><span class="pun">.</span><span class="pln">has_sidebar </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> fn</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">,</span><span class="pln"> arguments</span><span class="pun">);</span><span class="pln"> <br />&nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-17">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-17">&#182;</a>                </div>                <p>lookup for a special _sidebar.markdown file</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; fs</span><span class="pun">.</span><span class="pln">readFile</span><span class="pun">([</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> config</span><span class="pun">.</span><span class="pln">articleDir</span><span class="pun">,</span><span class="pln"> </span><span class="str">'_sidebar.markdown'</span><span class="pun">].</span><span class="pln">join</span><span class="pun">(</span><span class="str">'/'</span><span class="pun">),</span><span class="pln"> </span><span class="str">'utf8'</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> body</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(!</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data</span><span class="pun">.</span><span class="pln">sidebar </span><span class="pun">=</span><span class="pln"> cache </span><span class="pun">=</span><span class="pln"> ghm</span><span class="pun">.</span><span class="pln">parse</span><span class="pun">(</span><span class="pln">body</span><span class="pun">);</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; data</span><span class="pun">.</span><span class="pln">has_sidebar </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"><br /><br /></span></pre></div>              </td>            </tr>                                  <tr id="section-18">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-18">&#182;</a>                </div>                <p>whatever we've got (err), trigger callback</p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fn</span><span class="pun">.</span><span class="pln">apply</span><span class="pun">(</span><span class="kwd">self</span><span class="pun">,</span><span class="pln"> args</span><span class="pun">);</span><span class="pln"> <br />&nbsp; &nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="pun">};</span><span class="pln"><br />&nbsp; </span><span class="pun">},</span><span class="pln"><br />&nbsp; <br /></span></pre></div>              </td>            </tr>                                  <tr id="section-19">              <td class="docs">                <div class="pilwrap">                  <a class="pilcrow" href="#section-19">&#182;</a>                </div>                <h3>.extend(obj, *sources)</h3>

<p>Extend a given object with all the properties in passed-in object(s).
coming from <em><a href="http://documentcloud.github.com/underscore/#extend">underscore</a></em></p>              </td>              <td class="code">                <div class="highlight"><pre><span class="pln">&nbsp; extend</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> extend</span><span class="pun">(</span><span class="pln">obj</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; </span><span class="typ">Array</span><span class="pun">.</span><span class="pln">prototype</span><span class="pun">.</span><span class="pln">slice</span><span class="pun">.</span><span class="pln">call</span><span class="pun">(</span><span class="pln">arguments</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">).</span><span class="pln">forEach</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">source</span><span class="pun">){</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> prop </span><span class="kwd">in</span><span class="pln"> source</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">source</span><span class="pun">[</span><span class="pln">prop</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!==</span><span class="pln"> </span><span class="kwd">undefined</span><span class="pun">)</span><span class="pln"> obj</span><span class="pun">[</span><span class="pln">prop</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> source</span><span class="pun">[</span><span class="pln">prop</span><span class="pun">];</span><span class="pln"><br />&nbsp; &nbsp; &nbsp; </span><span class="pun">}</span><span class="pln"> &nbsp; &nbsp; &nbsp; &nbsp;<br />&nbsp; &nbsp; </span><span class="pun">});</span><span class="pln"><br />&nbsp; &nbsp; <br />&nbsp; &nbsp; </span><span class="kwd">return</span><span class="pln"> obj</span><span class="pun">;</span><span class="pln"><br />&nbsp; </span><span class="pun">}</span><span class="pln"><br /></span><span class="pun">};</span><span class="pln"><br /></span></pre></div>              </td>            </tr>                  </tbody>      </table>    </div>  </body>  </html>